<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø°ÙƒÙŠØ© | Ø§Ù†Ø´Ø± Ø§Ù„ÙØ±Ø­</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #e53e3e;
            --dark: #1a202c;
            --whatsapp: #25D366;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹ÙŠØ¯ÙŠØ© */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white; padding: 30px; border-radius: 25px;
            max-width: 400px; width: 85%; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        .main-wrapper {
            background: white; padding: 20px; border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1); width: 100%;
            max-width: 480px; text-align: center;
        }

        .joy-badge {
            background: #fff5f5; color: var(--primary); padding: 8px 18px;
            border-radius: 50px; font-size: 14px; font-weight: bold;
            display: inline-flex; margin-bottom: 15px; border: 1px solid #fed7d7;
        }

        #capture-area {
            position: relative; width: 100%; border-radius: 15px;
            overflow: hidden; margin-bottom: 20px; background: #fff;
            line-height: 0;
        }

        #template-img { width: 100%; height: auto; display: block; }

        #display-name {
            position: absolute; 
            bottom: 16%; /* Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ø£Ø³ÙÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø±Ù‚Ù… 4 */
            left: 50%;
            transform: translateX(-50%); 
            width: 90%;
            font-family: 'Amiri', serif; 
            font-size: clamp(24px, 5vw, 38px);
            color: #5b90af; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ */
            text-shadow: 2px 2px 8px rgba(171, 199, 169, 0.8); /* Ø¸Ù„ Ø£Ø®Ø¶Ø± Ø®ÙÙŠÙ */
            text-align: center; 
            pointer-events: none;
        }

        .action-btns { display: flex; flex-direction: column; gap: 10px; }

        input {
            padding: 16px; border: 2px solid #edf2f7; border-radius: 12px;
            font-size: 18px; text-align: center; font-family: 'Cairo'; outline: none;
        }

        .btn {
            padding: 16px; border: none; border-radius: 12px;
            font-weight: bold; font-size: 17px; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        .btn-download { background: var(--dark); color: white; }
        .btn-share { background: var(--whatsapp); color: white; display: none; }

        .footer-text { font-size: 11px; color: #a0aec0; margin-top: 15px; }
    </style>
</head>
<body>

<div class="modal-overlay" id="welcomeModal">
    <div class="modal-content">
        <h2 style="margin:0;">ğŸ Ø¹ÙŠØ¯ÙŠØ© Ø®Ø§ØµØ©!</h2>
        <p style="font-size: 15px; color: #4a5568;">
            Ø£Ø±Ø³Ù„ ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø¹ÙŠØ¯ Ù„Ù…Ù† ØªØ­Ø¨ØŒ ÙˆØ¥Ø°Ø§ ÙˆØµÙ„ØªÙ‡Ù… Ø¨Ø·Ø§Ù‚ØªÙƒâ€¦ Ù„Ù‡Ù… ÙˆÙ„ÙƒÙ… Ø¹ÙŠØ¯ÙŠØ© Ø®Ø§ØµØ© Ù…Ù†Ù‘Ø§ ğŸ
        </p>
        <button class="btn btn-download" style="width:100%" onclick="closeModal()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† âœ¨</button>
    </div>
</div>

<div class="main-wrapper">
    <div class="joy-badge">
        â¤ï¸ ØªÙ… Ù†Ø´Ø± Ø§Ù„ÙØ±Ø­ Ø¥Ù„Ù‰ <span id="joy-count">...</span> Ø´Ø®Øµ
    </div>

    <div id="capture-area">
        <img id="template-img" src="ØªÙ‡Ù†Ø¦Ø© Ø¹ÙŠØ¯ Ø³Ø¹ÙŠØ¯ Ù…Ø¨Ø§Ø±Ùƒ Ù‚ØµØ© Instagram ÙˆØ±Ø¯ Ø£Ù†ÙŠÙ‚  (4).jpg" crossorigin="anonymous">
        <div id="display-name">Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§</div>
    </div>

    <div class="action-btns">
        <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." oninput="updateUI()" maxlength="30">
        
        <button id="downloadBtn" class="btn btn-download" onclick="handleDownload()">
            âœ… ØµÙ…Ù… ÙˆØ­Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        </button>

        <button id="shareBtn" class="btn btn-share" onclick="handleShare()">
            ğŸ“² Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
        </button>
    </div>

    <div class="footer-text">ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± Â© 2026</div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx4IYUF-IlQEtBANNRfo_Lu0qai8ZWqTRn0e6IzczRSQeKTJ2Hi68JuQYpjQWtqrjsT/exec';
    let generatedBlob = null;

    function closeModal() { document.getElementById('welcomeModal').style.display = 'none'; }

    async function fetchCounter() {
        try {
            const response = await fetch(SCRIPT_URL + '?t=' + new Date().getTime());
            const count = await response.text();
            document.getElementById('joy-count').innerText = parseInt(count).toLocaleString();
        } catch (e) { document.getElementById('joy-count').innerText = "1,291"; }
    }
    fetchCounter();

    function updateUI() {
        document.getElementById('display-name').innerText = document.getElementById('nameInput').value || "Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§";
    }

    async function handleDownload() {
        const name = document.getElementById('nameInput').value;
        if (!name) { alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹ ÙŠØ§ ØºØ§Ù„ÙŠ"); return; }

        const btn = document.getElementById('downloadBtn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        btn.disabled = true;

        try {
            const canvas = await html2canvas(document.getElementById('capture-area'), { scale: 3, useCORS: true });
            
            canvas.toBlob(async (blob) => {
                generatedBlob = blob;
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.download = `ØªÙ‡Ù†Ø¦Ø©_${name}.png`;
                link.href = url;
                link.click();

                document.getElementById('shareBtn').style.display = 'flex';
                btn.innerText = "âœ¨ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­";
                
                fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors' });
                let current = parseInt(document.getElementById('joy-count').innerText.replace(/,/g, ''));
                document.getElementById('joy-count').innerText = (current + 1).toLocaleString();
            });

        } catch (err) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"); btn.disabled = false; }
    }

    // Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: ØªØ±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø© + Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙƒØ§Ù†
   async function handleShare() {
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹
        if (!generatedBlob) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± (ØµÙ…Ù… ÙˆØ­Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©) Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©");
            return;
        }

        const name = document.getElementById('nameInput').value || "ØµØ¯ÙŠÙ‚Ùƒ";
        
        // ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©
        const file = new File([generatedBlob], `Eid_Greeting.png`, { type: 'image/png' });

        // Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const locationURL = "https://maps.google.com/your-location"; // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
        const siteURL = window.location.href;

        // Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const shareText = `Ø¹ÙŠØ¯ Ù…Ø¨Ø§Ø±Ùƒ ÙˆÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± âœ¨\n\nğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹ÙŠØ¯ÙŠØ©:\n${locationURL}\n\nğŸ Ø§ØµÙ†Ø¹ ØªÙ‡Ù†Ø¦ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ù…Ù† Ù‡Ù†Ø§:\n${siteURL}`;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„ÙØ§Øª (ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ§Ù„Ø§Øª)
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
                await navigator.share({
                    files: [file],
                    text: shareText,
                });
            } catch (err) {
                console.log("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø£Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£");
            }
        } else {
            // Ø­Ù„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù…Ø«Ù„ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
            const whatsappText = encodeURIComponent(shareText);
            const waUrl = `https://api.whatsapp.com/send?text=${whatsappText}`;
            
            alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©. Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ.");
            window.open(waUrl, '_blank');
        }
    }
</script>

</body>
</html>